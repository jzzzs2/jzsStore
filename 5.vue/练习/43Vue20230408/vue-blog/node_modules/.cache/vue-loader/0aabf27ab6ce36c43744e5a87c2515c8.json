{"remainingRequest":"D:\\十字波\\五.vue框架\\练习\\37Vue20230331\\vue-blog\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\十字波\\五.vue框架\\练习\\37Vue20230331\\vue-blog\\src\\views\\Wechat.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\十字波\\五.vue框架\\练习\\37Vue20230331\\vue-blog\\src\\views\\Wechat.vue","mtime":1680170090605},{"path":"D:\\十字波\\五.vue框架\\练习\\37Vue20230331\\vue-blog\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1678865246950},{"path":"D:\\十字波\\五.vue框架\\练习\\37Vue20230331\\vue-blog\\node_modules\\babel-loader\\lib\\index.js","mtime":1678865247956},{"path":"D:\\十字波\\五.vue框架\\练习\\37Vue20230331\\vue-blog\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1678865246950},{"path":"D:\\十字波\\五.vue框架\\练习\\37Vue20230331\\vue-blog\\node_modules\\vue-loader\\lib\\index.js","mtime":1678865248335}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQppbXBvcnQgdnVlc2Nyb2xsIGZyb20gInZ1ZXNjcm9sbCI7DQppbXBvcnQgVnVlIGZyb20gInZ1ZSI7DQppbXBvcnQgeyBpbyB9IGZyb20gInNvY2tldC5pby1jbGllbnQiOw0KZXhwb3J0IGRlZmF1bHQgew0KICBjb21wb25lbnRzOiB7DQogICAgdnVlc2Nyb2xsLA0KICB9LA0KICBkYXRhKCkgew0KICAgIHJldHVybiB7DQogICAgICBjb250ZW50OiAiIiwNCiAgICAgIGluZm9MaXN0OiBbXSwNCiAgICAgIHNvY2tldDogbnVsbCwNCiAgICAgIG5pY2tOYW1lOiAiIiwNCiAgICAgIGlzTmFtZTogZmFsc2UsDQogICAgICBuYW1lQ29udGVudDogIiIsDQogICAgICBvcHM6IHsNCiAgICAgICAgdnVlc2Nyb2xsOiB7fSwNCiAgICAgICAgc2Nyb2xsUGFuZWw6IHt9LA0KICAgICAgICByYWlsOiB7DQogICAgICAgICAgYmFja2dyb3VuZDogIiMwMWE5OWEiLA0KICAgICAgICAgIG9wYWNpdHk6IDAsDQogICAgICAgICAgc2l6ZTogIjZweCIsDQogICAgICAgICAgc3BlY2lmeUJvcmRlclJhZGl1czogZmFsc2UsDQogICAgICAgICAgZ3V0dGVyT2ZFbmRzOiBudWxsLA0KICAgICAgICAgIGd1dHRlck9mU2lkZTogIjJweCIsDQogICAgICAgICAga2VlcFNob3c6IGZhbHNlLA0KICAgICAgICB9LA0KICAgICAgICBiYXI6IHt9LA0KICAgICAgfSwNCiAgICB9Ow0KICB9LA0KICBjcmVhdGVkKCkgew0KICAgIHRoaXMuJHN0b3JlLnN0YXRlLmRpcmVjdGlvbiA9ICJyaWdodCI7DQogICAgbGV0IHNvY2tldCA9IGlvKHByb2Nlc3MuZW52WyJWVUVfQVBQX1NPQ0tFVF9VUkwiXSwgew0KICAgICAgdHJhbnNwb3J0czogWyJ3ZWJzb2NrZXQiXSwNCiAgICB9KTsNCiAgICBjb25zb2xlLmxvZyhzb2NrZXQsICJzb2NrZXQiKTsNCiAgICB0aGlzLnNvY2tldCA9IHNvY2tldDsNCiAgICBsZXQgbmFtZSA9IHRoaXMuJHN0b3JlLnN0YXRlLnVzZXJJbmZvPy5uaWNrbmFtZTsNCiAgICBjb25zb2xlLmxvZyhuYW1lLCAibmFtZSB4eHh4Iik7DQogICAgbmFtZSA/ICh0aGlzLm5pY2tOYW1lID0gbmFtZSkgOiAodGhpcy5uaWNrTmFtZSA9ICIiKTsNCiAgICBuYW1lID8gKHRoaXMuaXNOYW1lID0gdHJ1ZSkgOiAodGhpcy5pc05hbWUgPSBmYWxzZSk7DQogICAgaWYgKG5hbWUpIHsNCiAgICAgIHRoaXMuc29ja2V0LmVtaXQoImxvZ2luIiwgeyBuaWNrbmFtZTogbmFtZSwgdHlwZTogImFjdGlvbiIgfSk7DQogICAgfQ0KICAgIHNvY2tldC5vbigiY29ubmVjdCIsICgpID0+IHsNCiAgICAgIGNvbnNvbGUubG9nKCJzb2NrZXQiLCAi5a6i5oi356uv6L+e5o6l5bu656uLIik7DQogICAgICBzb2NrZXQub24oImVudGVyIiwgKG9iaikgPT4gew0KICAgICAgICBpZiAob2JqLmVycm9yKSB7DQogICAgICAgICAgVnVlLnByb3RvdHlwZS4kbm90aWZ5KHsNCiAgICAgICAgICAgIHRpdGxlOiAi6K2m5ZGKIiwNCiAgICAgICAgICAgIG1lc3NhZ2U6ICLmmLXnp7Dph43lpI0iLA0KICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLA0KICAgICAgICAgIH0pOw0KICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICAgICAgICBpZiAob2JqLnVzZXIgPT09ICJtZSIpIHsNCiAgICAgICAgICB0aGlzLmlzTmFtZSA9IHRydWU7DQogICAgICAgICAgdGhpcy5uaWNrTmFtZSA9IG9iai5uaWNrbmFtZTsNCiAgICAgICAgfQ0KICAgICAgICAvLyBjb25zb2xlLmxvZyhvYmosICJlbnRlciIpOw0KICAgICAgICB0aGlzLmluZm9MaXN0LnB1c2gob2JqKTsNCiAgICAgIH0pOw0KICAgICAgc29ja2V0Lm9uKCJsZWF2ZSIsIChvYmopID0+IHsNCiAgICAgICAgdGhpcy5pbmZvTGlzdC5wdXNoKG9iaik7DQogICAgICAgIGNvbnNvbGUubG9nKG9iaiwgImxlYXZlIik7DQogICAgICB9KTsNCiAgICAgIHNvY2tldC5vbigicmVjZWl2ZSIsIChvYmopID0+IHsNCiAgICAgICAgdGhpcy5pbmZvTGlzdC5wdXNoKG9iaik7DQogICAgICAgIGNvbnNvbGUubG9nKG9iaiwgIm9iaiIpOw0KICAgICAgfSk7DQogICAgfSk7DQogIH0sDQogIGJlZm9yZURlc3Ryb3koKSB7DQogICAgdGhpcy5zb2NrZXQuY2xvc2UoKTsNCiAgfSwNCg0KICBtb3VudGVkKCkgew0KICAgIHRoaXMuJGJ1cy4kb24oImNsZWFyQ2hhdFNvY2tldCIsIHRoaXMuY2xlYXJTb2NrZXQpOw0KICB9LA0KICBtZXRob2RzOiB7DQogICAgY2xlYXJTb2NrZXQoKSB7DQogICAgICB0aGlzLnNvY2tldC5jbG9zZSgpOw0KICAgIH0sDQogICAgc2VuZCgpIHsNCiAgICAgIHRoaXMuc29ja2V0LmVtaXQoImNoYXQiLCB7IG1zZzogdGhpcy5jb250ZW50LCBuaWNrbmFtZTogdGhpcy5uaWNrTmFtZSB9KTsNCiAgICAgIHRoaXMuY29udGVudCA9ICIiOw0KICAgIH0sDQogICAgc3VibWl0TmFtZSgpIHsNCiAgICAgIHRoaXMuc29ja2V0LmVtaXQoImxvZ2luIiwgeyBuaWNrbmFtZTogdGhpcy5uYW1lQ29udGVudCB9KTsNCiAgICB9LA0KICB9LA0KfTsNCg=="},{"version":3,"sources":["Wechat.vue"],"names":[],"mappings":";AA6CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Wechat.vue","sourceRoot":"src/views","sourcesContent":["<!--\r\n * @Descripttion: \r\n * @version: \r\n * @Author: sueRimn\r\n * @Date: 2023-03-28 16:09:45\r\n * @LastEditors: sueRimn\r\n * @LastEditTime: 2023-03-30 17:54:50\r\n-->\r\n<template>\r\n  <div class=\"blog-room--wrap\">\r\n    \r\n      <div class=\"blog-room--content\">\r\n        <vuescroll :ops=\"ops\">\r\n        <div class=\"blog-room--info\" v-for=\"(item, idx) in infoList\" :key=\"idx\">\r\n          <div class=\"blog-room--info--wrap\" :class=\"item.type\">\r\n            <span class=\"userClass\" v-if=\"item?.type !== 'action'\">{{\r\n              item?.type === \"action\" ? \"\" : item?.nickname\r\n            }}</span>\r\n            <div :class=\"{ 'blog-info--offset': item?.type !== 'action' }\">\r\n              <p class=\"left\" :class=\"{ mtb20: item?.type === 'action' }\">\r\n                {{ item?.msg }}\r\n              </p>\r\n              <span class=\"fz12\">{{ item?.time }}</span>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        </vuescroll>\r\n      </div>\r\n      <div class=\"blog-room--input\">\r\n        <el-input v-model=\"content\" placeholder=\"请输入内容\"></el-input>\r\n        <el-button type=\"primary\" @click=\"send\">发送</el-button>\r\n      </div>\r\n      <!--  -->\r\n      <el-dialog title=\"注册昵称\" :visible=\"!isName\" width=\"30%\">\r\n        <el-input v-model=\"nameContent\" placeholder=\"昵称\"></el-input>\r\n        <span slot=\"footer\" class=\"dialog-footer\">\r\n          <el-button type=\"primary\" @click=\"submitName\">提交</el-button>\r\n        </span>\r\n        \r\n      </el-dialog>\r\n    \r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport vuescroll from \"vuescroll\";\r\nimport Vue from \"vue\";\r\nimport { io } from \"socket.io-client\";\r\nexport default {\r\n  components: {\r\n    vuescroll,\r\n  },\r\n  data() {\r\n    return {\r\n      content: \"\",\r\n      infoList: [],\r\n      socket: null,\r\n      nickName: \"\",\r\n      isName: false,\r\n      nameContent: \"\",\r\n      ops: {\r\n        vuescroll: {},\r\n        scrollPanel: {},\r\n        rail: {\r\n          background: \"#01a99a\",\r\n          opacity: 0,\r\n          size: \"6px\",\r\n          specifyBorderRadius: false,\r\n          gutterOfEnds: null,\r\n          gutterOfSide: \"2px\",\r\n          keepShow: false,\r\n        },\r\n        bar: {},\r\n      },\r\n    };\r\n  },\r\n  created() {\r\n    this.$store.state.direction = \"right\";\r\n    let socket = io(process.env[\"VUE_APP_SOCKET_URL\"], {\r\n      transports: [\"websocket\"],\r\n    });\r\n    console.log(socket, \"socket\");\r\n    this.socket = socket;\r\n    let name = this.$store.state.userInfo?.nickname;\r\n    console.log(name, \"name xxxx\");\r\n    name ? (this.nickName = name) : (this.nickName = \"\");\r\n    name ? (this.isName = true) : (this.isName = false);\r\n    if (name) {\r\n      this.socket.emit(\"login\", { nickname: name, type: \"action\" });\r\n    }\r\n    socket.on(\"connect\", () => {\r\n      console.log(\"socket\", \"客户端连接建立\");\r\n      socket.on(\"enter\", (obj) => {\r\n        if (obj.error) {\r\n          Vue.prototype.$notify({\r\n            title: \"警告\",\r\n            message: \"昵称重复\",\r\n            type: \"warning\",\r\n          });\r\n          return;\r\n        }\r\n        if (obj.user === \"me\") {\r\n          this.isName = true;\r\n          this.nickName = obj.nickname;\r\n        }\r\n        // console.log(obj, \"enter\");\r\n        this.infoList.push(obj);\r\n      });\r\n      socket.on(\"leave\", (obj) => {\r\n        this.infoList.push(obj);\r\n        console.log(obj, \"leave\");\r\n      });\r\n      socket.on(\"receive\", (obj) => {\r\n        this.infoList.push(obj);\r\n        console.log(obj, \"obj\");\r\n      });\r\n    });\r\n  },\r\n  beforeDestroy() {\r\n    this.socket.close();\r\n  },\r\n\r\n  mounted() {\r\n    this.$bus.$on(\"clearChatSocket\", this.clearSocket);\r\n  },\r\n  methods: {\r\n    clearSocket() {\r\n      this.socket.close();\r\n    },\r\n    send() {\r\n      this.socket.emit(\"chat\", { msg: this.content, nickname: this.nickName });\r\n      this.content = \"\";\r\n    },\r\n    submitName() {\r\n      this.socket.emit(\"login\", { nickname: this.nameContent });\r\n    },\r\n  },\r\n};\r\n</script>\r\n\r\n<style lang=\"stylus\" scoped>\r\n.blog-room--wrap\r\n  // height: 50vh\r\n\r\n.blog-room--content {\r\n  display: flex;\r\n  flex-direction: column;\r\n  justify-content: flex-start;\r\n  height: 60vh;\r\n  // overflow-x: hidden;\r\n  // overflow-y: auto;\r\n  background-color: #fff;\r\n  padding-bottom: 40px\r\n}\r\n\r\n.blog-room--info {\r\n  // height: 50vh;\r\n  margin: 10px 0px 5px;\r\n}\r\n\r\n.blog-room--info--wrap {\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n\r\n  & * {\r\n    margin: 2px 6px;\r\n  }\r\n\r\n  & p {\r\n    border-radius: 6px;\r\n    background-color: #fff;\r\n    border: 1px solid #ccc;\r\n    background-color: cyan;\r\n  }\r\n}\r\n\r\n\r\n.blog-room--info--wrap.left {\r\n  align-items: center;\r\n  justify-content: flex-start;\r\n\r\n  & p {\r\n    border-radius: 6px;\r\n    background-color: pink;\r\n    border: 1px solid #ccc;\r\n  }\r\n}\r\n\r\n.blog-room--info--wrap.right {\r\n  flex-direction: row-reverse;\r\n  justify-content: flex-start;\r\n  align-items: center;\r\n\r\n  & p {\r\n    border-radius: 6px;\r\n    background-color: skyblue;\r\n    border: 1px solid #ccc;\r\n  }\r\n}\r\n\r\n.userClass {\r\n  width: 40px;\r\n  height: 20px;\r\n  border-radius: 10px 6px;\r\n  color: pink;\r\n  font-size: 20px;\r\n  background-color: #eee;\r\n}\r\n\r\n.fz12 {\r\n  font-size: 12px;\r\n}\r\n\r\n.blog-room--input {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  margin-top: 30px\r\n}\r\n\r\n.blog-info--offset {\r\n  display: flex;\r\n  flex-direction: column;\r\n  justify-content: space-around;\r\n  align-items: center;\r\n  border-radius: 20px;\r\n  border: 1px solid pink;\r\n  position: relative;\r\n  top: 12px;\r\n  padding: 2px;\r\n}\r\n</style>\r\n"]}]}