{"remainingRequest":"D:\\十字波\\五.vue框架\\练习\\43Vue20230408\\vue-blog\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\十字波\\五.vue框架\\练习\\43Vue20230408\\vue-blog\\src\\views\\Modal.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\十字波\\五.vue框架\\练习\\43Vue20230408\\vue-blog\\src\\views\\Modal.vue","mtime":1680770593606},{"path":"D:\\十字波\\五.vue框架\\练习\\43Vue20230408\\vue-blog\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1678865246950},{"path":"D:\\十字波\\五.vue框架\\练习\\43Vue20230408\\vue-blog\\node_modules\\babel-loader\\lib\\index.js","mtime":1678865247956},{"path":"D:\\十字波\\五.vue框架\\练习\\43Vue20230408\\vue-blog\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1678865246950},{"path":"D:\\十字波\\五.vue框架\\练习\\43Vue20230408\\vue-blog\\node_modules\\vue-loader\\lib\\index.js","mtime":1678865248335}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQppbXBvcnQgVnVlIGZyb20gICJ2dWUiDQppbXBvcnQgcm91dGVyIGZyb20gIkAvcm91dGVyL2luZGV4Ig0KaW1wb3J0IHsgaW8gfSBmcm9tICJzb2NrZXQuaW8tY2xpZW50IjsNCmltcG9ydCB7IGNyZWF0ZU5hbWVzcGFjZWRIZWxwZXJzIH0gZnJvbSAidnVleCI7DQpsZXQgeyBtYXBTdGF0ZSB9ID0gY3JlYXRlTmFtZXNwYWNlZEhlbHBlcnMoIm1vZGFsIik7DQppbXBvcnQgRm9ybSBmcm9tICJAL2NvbXBvbmVudHMvRm9ybS52dWUiOw0KaW1wb3J0IGZvcm1EYXRhcyBmcm9tICJAL2NvbmZpZy9tb2RhbC5jb25maWcuanMiOw0KZXhwb3J0IGRlZmF1bHQgew0KICBjb21wb25lbnRzOiB7DQogICAgRm9ybSwNCiAgfSwNCiAgZGF0YSgpIHsNCiAgICByZXR1cm4ge307DQogIH0sDQogIGNvbXB1dGVkOiB7DQogICAgdXNlckluZm8oKSB7DQogICAgICByZXR1cm4gdGhpcy4kc3RvcmUudXNlckluZm8gfHwgIum7mOiupG5pY2tuYW1lIjsNCiAgICB9LA0KICAgIC4uLm1hcFN0YXRlKFsidHlwZSJdKSwNCiAgICBpc1Nob3c6IHsNCiAgICAgIHNldChkYXRhVikgew0KICAgICAgICB0aGlzLiRzdG9yZS5zdGF0ZS5tb2RhbC5pc1Nob3cgPSBkYXRhVjsNCiAgICAgIH0sDQogICAgICBnZXQoKSB7DQogICAgICAgIHJldHVybiB0aGlzLiRzdG9yZS5zdGF0ZS5tb2RhbC5pc1Nob3c7DQogICAgICB9LA0KICAgIH0sDQogICAgd2lkdGgoKSB7DQogICAgICByZXR1cm4gdGhpcy50eXBlID8gZm9ybURhdGFzW3RoaXMudHlwZV0ud2lkdGggOiAiIjsNCiAgICB9LA0KICAgIHRpdGxlKCkgew0KICAgICAgcmV0dXJuIHRoaXMudHlwZSA/IGZvcm1EYXRhc1t0aGlzLnR5cGVdLnRpdGxlIDogIiI7DQogICAgfSwNCiAgICBmb3JtRGF0YSgpIHsNCiAgICAgIHJldHVybiB0aGlzLnR5cGUgPyBmb3JtRGF0YXNbdGhpcy50eXBlXS5mb3JtRGF0YSA6ICIiOw0KICAgIH0sDQogICAgYnRucygpIHsNCiAgICAgIHJldHVybiB0aGlzLnR5cGUgPyBmb3JtRGF0YXNbdGhpcy50eXBlXS5idG5zIDogIiI7DQogICAgfSwNCiAgfSwNCiAgbW91bnRlZCgpIHsNCiAgICBjb25zb2xlLmxvZyh0aGlzLnR5cGUsICJtb3VudGVkIik7DQogICAgY29uc29sZS5sb2coIk1PREVMIOWIm+W7uiIpOw0KICB9LA0KICBiZWZvcmVEZXN0cm95KCkgew0KICAgIGNvbnNvbGUubG9nKCJNT0RBTCDplIDmr4EiKTsNCiAgfSwNCg0KICBtZXRob2RzOiB7DQogICAgaGFuZGxlQ2xvc2UoZG9uZSkgew0KICAgICAgZG9uZSgpOw0KICAgIH0sDQogICAgaGFuZGxlQWdlbnQodHlwZSkgew0KICAgICAgdGhpc1t0eXBlXSgpOw0KICAgIH0sDQogICAgY29uZmlybSgpIHsNCiAgICAgIGxldCBmb3JtID0gdGhpcy4kcmVmc1siZm9ybSJdOw0KICAgICAgZm9ybS4kcmVmc1siZWxGb3JtIl0udmFsaWRhdGUoYXN5bmMgKHZhbGlkKSA9PiB7DQogICAgICAgIGlmICh2YWxpZCkgew0KICAgICAgICAgIGxldCBkYXRhID0gZm9ybVsicnVsZUZvcm0iXTsNCiAgICAgICAgICBjb25zb2xlLmxvZyhkYXRhLCAiZm9ybSDmlbDmja4iKTsNCiAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgbGV0IHJlc3VsdCA9IGF3YWl0IHRoaXMuJGh0dHAoeyB0eXBlOiB0aGlzLnR5cGUsIGRhdGEgfSk7DQogICAgICAgICAgICBpZiAocmVzdWx0LmRhdGEuZGF0YS50b2tlbikgew0KICAgICAgICAgICAgICAvL+S/ruaUueeKtuaAgeW5tuS4lOiOt+WPlueUqOaIt+S/oeaBrw0KICAgICAgICAgICAgICBhd2FpdCB0aGlzLiRzdG9yZS5kaXNwYXRjaCgic2V0VG9rZW4iLCByZXN1bHQuZGF0YS5kYXRhLnRva2VuKTsNCiAgICAgICAgICAgICAgLy/miJDlip/nmbvlvZUg6L+e5o6lc29ja2V0DQogICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3VsdC5kYXRhLmRhdGEsICJkYXRheHh4Iik7DQogICAgICAgICAgICAgIGxldCBzb2NrZXRVc2VyID0gaW8ocHJvY2Vzcy5lbnZbIlZVRV9BUFBfU09DS0VUX1VSTCJdLCB7DQogICAgICAgICAgICAgICAgdHJhbnNwb3J0czogWyJ3ZWJzb2NrZXQiXSwNCiAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgIHNvY2tldFVzZXIub24oImNvbm5lY3QiLCAoKSA9PiB7DQogICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coc29ja2V0VXNlci50ZXN0TmFtZSwidGVzdCIpOw0KICAgICAgICAgICAgICAgIFZ1ZS5wcm90b3R5cGUuJHNvY2tldCA9IHNvY2tldFVzZXINCiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhWdWUucHJvdG90eXBlLiRzb2NrZXQsInh4eCB2dWUgc29ja2V0Iik7DQogICAgICAgICAgICAgICAgVnVlLnByb3RvdHlwZS4kb3duID0gZmFsc2UNCiAgICAgICAgICAgICAgICBzb2NrZXRVc2VyLmVtaXQoImxvZ2luVXNlciIsIHsNCiAgICAgICAgICAgICAgICAgIG5pY2tuYW1lOiByZXN1bHQuZGF0YS5kYXRhLm5pY2tuYW1lLA0KICAgICAgICAgICAgICAgICAgdWlkOiByZXN1bHQuZGF0YS5kYXRhWyJfaWQiXSwNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICBzb2NrZXRVc2VyLm9uKCJkaXNjb25uZWN0IiwgKCkgPT4gew0KICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coIua4heepuiIsInF1aXR0dHR0dHR0dHR0dHR0Iik7DQogICAgICAgICAgICAgICAgICB0aGlzLiRidXMuJGVtaXQoImNsZWFyQ2hhdFNvY2tldCIpDQogICAgICAgICAgICAgICAgICBpZiAoVnVlLnByb3RvdHlwZS4kb3duKSB7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuJHN0b3JlLmRpc3BhdGNoKCJjbGVhclVzZXIiLHt0eXBlOiAxfSk7DQogICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICB0aGlzLiRzdG9yZS5kaXNwYXRjaCgiY2xlYXJVc2VyIix7dHlwZTogMH0pOw0KICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgcm91dGVyLnB1c2goIi8iKQ0KICAgICAgICAgICAgICAgICAgLy8gdGhpcy4kbm90aWZ5KHsNCiAgICAgICAgICAgICAgICAgIC8vICAgdGl0bGU6ICLpgJrnn6UiLA0KICAgICAgICAgICAgICAgICAgLy8gICBtZXNzYWdlOiLlhbblroPorr7lpIflt7LnmbvlvZUiLA0KICAgICAgICAgICAgICAgICAgLy8gICB0eXBlOiAid2FybmluZyIsDQogICAgICAgICAgICAgICAgICAvLyB9KTsNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAodGhpcy50eXBlID09PSAiY2xhc3NpZnlBZGQiKSB7DQogICAgICAgICAgICAgIGNvbnNvbGUubG9nKCLop6blj5HkuIDmrKHmj5DkuqQiKTsNCiAgICAgICAgICAgICAgdGhpcy4kYnVzLiRlbWl0KCJmbGFzaENsYXNzaWZ5Iik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBmb3JtLiRyZWZzWyJlbEZvcm0iXS5yZXNldEZpZWxkcygpOw0KICAgICAgICAgICAgdGhpcy4kc3RvcmUuZGlzcGF0Y2goIm1vZGFsL2Nsb3NlTW9kYWwiKTsNCiAgICAgICAgICB9IGNhdGNoIChlcnJvcikgew0KICAgICAgICAgICAgY29uc29sZS5sb2coZXJyb3IsICJlcnJvciIpOw0KICAgICAgICAgICAgbGV0IG1lc3NhZ2UgPSBlcnJvcj8ucmVzcG9uc2U/LmRhdGE/Lm1lc3NhZ2U7DQogICAgICAgICAgICB0aGlzLiRub3RpZnkoew0KICAgICAgICAgICAgICB0aXRsZTogIuitpuWRiiIsDQogICAgICAgICAgICAgIG1lc3NhZ2UsDQogICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwNCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgZm9ybS4kcmVmc1siZWxGb3JtIl0ucmVzZXRGaWVsZHMoKTsNCiAgICAgICAgICB9DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgdGhpcy4kbm90aWZ5KHsNCiAgICAgICAgICAgIHRpdGxlOiAi6K2m5ZGKIiwNCiAgICAgICAgICAgIG1lc3NhZ2U6ICLooajljZXmlbDmja7kuI3nrKblkIgiLA0KICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLA0KICAgICAgICAgIH0pOw0KICAgICAgICB9DQogICAgICB9KTsNCiAgICB9LA0KICAgIGNsb3NlKCkgew0KICAgICAgdGhpcy4kc3RvcmUuZGlzcGF0Y2goIm1vZGFsL2Nsb3NlTW9kYWwiKTsNCiAgICB9LA0KICB9LA0KfTsNCg=="},{"version":3,"sources":["Modal.vue"],"names":[],"mappings":";AA6CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Modal.vue","sourceRoot":"src/views","sourcesContent":["<!--\r\n * @Descripttion: \r\n * @version: \r\n * @Author: sueRimn\r\n * @Date: 2023-03-16 15:06:23\r\n * @LastEditors: sueRimn\r\n * @LastEditTime: 2023-04-04 17:36:32\r\n-->\r\n<!--\r\n * @Descripttion: \r\n * @version: \r\n * @Author: sueRimn\r\n * @Date: 2023-03-16 15:06:23\r\n * @LastEditors: sueRimn\r\n * @LastEditTime: 2023-03-18 15:28:53\r\n-->\r\n<!--\r\n * @Descripttion: \r\n * @version: \r\n * @Author: sueRimn\r\n * @Date: 2023-03-16 15:06:23\r\n * @LastEditors: sueRimn\r\n * @LastEditTime: 2023-03-17 20:01:43\r\n-->\r\n<template>\r\n  <el-dialog\r\n    :title=\"title\"\r\n    :visible.sync=\"isShow\"\r\n    :width=\"width\"\r\n    :before-close=\"handleClose\"\r\n  >\r\n    <Form ref=\"form\" :type=\"type\" />\r\n    <span slot=\"footer\" class=\"dialog-footer\">\r\n      <el-button\r\n        :type=\"item.isSubmit ? 'primary' : ''\"\r\n        v-for=\"(item, idx) in btns\"\r\n        :key=\"idx\"\r\n        @click=\"handleAgent(item.targetName)\"\r\n        >{{ item.name }}</el-button\r\n      >\r\n    </span>\r\n  </el-dialog>\r\n</template>\r\n\r\n<script>\r\nimport Vue from  \"vue\"\r\nimport router from \"@/router/index\"\r\nimport { io } from \"socket.io-client\";\r\nimport { createNamespacedHelpers } from \"vuex\";\r\nlet { mapState } = createNamespacedHelpers(\"modal\");\r\nimport Form from \"@/components/Form.vue\";\r\nimport formDatas from \"@/config/modal.config.js\";\r\nexport default {\r\n  components: {\r\n    Form,\r\n  },\r\n  data() {\r\n    return {};\r\n  },\r\n  computed: {\r\n    userInfo() {\r\n      return this.$store.userInfo || \"默认nickname\";\r\n    },\r\n    ...mapState([\"type\"]),\r\n    isShow: {\r\n      set(dataV) {\r\n        this.$store.state.modal.isShow = dataV;\r\n      },\r\n      get() {\r\n        return this.$store.state.modal.isShow;\r\n      },\r\n    },\r\n    width() {\r\n      return this.type ? formDatas[this.type].width : \"\";\r\n    },\r\n    title() {\r\n      return this.type ? formDatas[this.type].title : \"\";\r\n    },\r\n    formData() {\r\n      return this.type ? formDatas[this.type].formData : \"\";\r\n    },\r\n    btns() {\r\n      return this.type ? formDatas[this.type].btns : \"\";\r\n    },\r\n  },\r\n  mounted() {\r\n    console.log(this.type, \"mounted\");\r\n    console.log(\"MODEL 创建\");\r\n  },\r\n  beforeDestroy() {\r\n    console.log(\"MODAL 销毁\");\r\n  },\r\n\r\n  methods: {\r\n    handleClose(done) {\r\n      done();\r\n    },\r\n    handleAgent(type) {\r\n      this[type]();\r\n    },\r\n    confirm() {\r\n      let form = this.$refs[\"form\"];\r\n      form.$refs[\"elForm\"].validate(async (valid) => {\r\n        if (valid) {\r\n          let data = form[\"ruleForm\"];\r\n          console.log(data, \"form 数据\");\r\n          try {\r\n            let result = await this.$http({ type: this.type, data });\r\n            if (result.data.data.token) {\r\n              //修改状态并且获取用户信息\r\n              await this.$store.dispatch(\"setToken\", result.data.data.token);\r\n              //成功登录 连接socket\r\n              console.log(result.data.data, \"dataxxx\");\r\n              let socketUser = io(process.env[\"VUE_APP_SOCKET_URL\"], {\r\n                transports: [\"websocket\"],\r\n              });\r\n              socketUser.on(\"connect\", () => {\r\n                // console.log(socketUser.testName,\"test\");\r\n                Vue.prototype.$socket = socketUser\r\n                console.log(Vue.prototype.$socket,\"xxx vue socket\");\r\n                Vue.prototype.$own = false\r\n                socketUser.emit(\"loginUser\", {\r\n                  nickname: result.data.data.nickname,\r\n                  uid: result.data.data[\"_id\"],\r\n                });\r\n                socketUser.on(\"disconnect\", () => {\r\n                  console.log(\"清空\",\"quitttttttttttttt\");\r\n                  this.$bus.$emit(\"clearChatSocket\")\r\n                  if (Vue.prototype.$own) {\r\n                    this.$store.dispatch(\"clearUser\",{type: 1});\r\n                  } else {\r\n                    this.$store.dispatch(\"clearUser\",{type: 0});\r\n                  }\r\n                  router.push(\"/\")\r\n                  // this.$notify({\r\n                  //   title: \"通知\",\r\n                  //   message:\"其它设备已登录\",\r\n                  //   type: \"warning\",\r\n                  // });\r\n                });\r\n              });\r\n            }\r\n            if (this.type === \"classifyAdd\") {\r\n              console.log(\"触发一次提交\");\r\n              this.$bus.$emit(\"flashClassify\");\r\n            }\r\n            form.$refs[\"elForm\"].resetFields();\r\n            this.$store.dispatch(\"modal/closeModal\");\r\n          } catch (error) {\r\n            console.log(error, \"error\");\r\n            let message = error?.response?.data?.message;\r\n            this.$notify({\r\n              title: \"警告\",\r\n              message,\r\n              type: \"warning\",\r\n            });\r\n            form.$refs[\"elForm\"].resetFields();\r\n          }\r\n        } else {\r\n          this.$notify({\r\n            title: \"警告\",\r\n            message: \"表单数据不符合\",\r\n            type: \"warning\",\r\n          });\r\n        }\r\n      });\r\n    },\r\n    close() {\r\n      this.$store.dispatch(\"modal/closeModal\");\r\n    },\r\n  },\r\n};\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n</style>"]}]}