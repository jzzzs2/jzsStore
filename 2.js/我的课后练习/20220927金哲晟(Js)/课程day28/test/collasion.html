<!--
 * @Descripttion: 
 * @version: 
 * @Author: sueRimn
 * @Date: 2022-09-27 20:28:14
 * @LastEditors: sueRimn
 * @LastEditTime: 2022-09-27 22:03:19
-->
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>碰撞检测</title>
  <script src="my.js"></script>
  <style>
    body {
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .box {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      align-content: space-between;
      position: relative;
      width: 660px;
      height: 660px;
      box-shadow: 0 0 8px #222;
    }

    .child {
      /* position: absolute; */
      width: 150px;
      height: 150px;
      background-color: pink;
      cursor: pointer;
      user-select: none;
    }

    img {
      display: block;
      width: 290px;
      height: 137px;
      pointer-events: none;
      /*禁止鼠标事件默认行为*/
    }
    /* .child:nth-of-type(1) {
      background-color: red;
    }

    .child:nth-of-type(2) {
      top: 200px;
      left: 100px;
      background-color: green;
    }

    .child:nth-of-type(3) {
      top: 400px;
      left: 100px;
      background-color: skyblue;
    }

    .child:nth-of-type(4) {
      top: 200px;
      left: 300px;
      background-color: pink;
    } */
  </style>
</head>

<body>
  <div class="box">
    <div class="child"></div>
    <div class="child"></div>
    <div class="child"></div>
    <div class="child"></div>
    <div class="child"></div>
    <div class="child"></div>
    <div class="child"></div>
    <div class="child"></div>
    <div class="child"></div>
    <div class="child"></div>
    <div class="child"></div>
    <div class="child"></div>
    <div class="child"></div>
    <div class="child"></div>
    <div class="child"></div>
    <div class="child"></div>
  </div>
  <script>
    var oBox = $(".box");
    var eventTypeMap = {
      instanceArr:[],
      isDown : false,
      len: oBox.children.length,
      moveInfo: {
        mouseLeft: 0,
        mouseTop: 0,
        eleLeft: 0,
        eleTop: 0
      },
      "mousedown": function (e) {
        this.moveInfo.mouseLeft = e.clientX;
        this.moveInfo.mouseTop = e.clientY;
        this.moveInfo.eleLeft = e.target.offsetLeft;
        this.moveInfo.eleTop = e.target.offsetTop;
        this.isDown = true;
      },
      "mousemove": function (e) {
        if (this.isDown) {
          var _x = e.clientX - this.moveInfo.mouseLeft;
          var _y = e.clientY - this.moveInfo.mouseTop;
          var top = this.moveInfo.eleTop + _y;
          var left = this.moveInfo.eleLeft + _x;
          top = Math.max(0, top);
          top = Math.min(top, oBox.offsetHeight - e.target.offsetHeight);
          left = Math.max(0, left);
          left = Math.min(left, oBox.offsetWidth - e.target.offsetWidth);
          e.target.style.top = top + "px";
          e.target.style.left = left + "px";
          //
          for(var i = 0; i < this.len; i++) {
            oBox.children[i].style.transform = "";
            if (oBox.children[i] !== e.target) {
              if (isCollision(e.target, oBox.children[i])) {
                oBox.children[i].style.transform = "scale(1.2)";
              }
            }
          }
        }
      },
      "mouseup": function (e) {
        this.isDown = false;
      }
    }
    oBox.addEventListener("mousedown",drag)

    document.addEventListener("mousemove",drag)

    oBox.addEventListener("mouseup",drag)

    function drag(e) {
      if (eventTypeMap[e.type] && typeof eventTypeMap[e.type] === "function") {
        eventTypeMap[e.type](e);
      }
    }

    function isCollision(ele1, ele2) {
      var l1  = ele1.offsetLeft;
      var r1 = l1 + ele1.offsetWidth;
      var b1 = ele1.offsetTop;
      var t1 = b1 + ele1.offsetHeight;
      var l2 = ele2.offsetLeft;
      var r2 = l2 + ele2.offsetWidth;
      var b2 = ele2.offsetTop;
      var t2 = b2 + ele2.offsetHeight;
      if (l1 > r2 || l2 > r1 || t1 < b2 || b1 > t2) {
        return false;
      } else {
        return true;
      }
    }

    function initEle () {
      for(var i = 0; i < eventTypeMap.len; i++) {
        var arr = [];
        arr.push(oBox.children[i].offsetLeft);
        arr.push(oBox.children[i].offsetTop);
        eventTypeMap.instanceArr.push(arr);
        (function (index) {
          setTimeout(function () {
            //赋值的时候避免计算
            oBox.children[index].style.position = "absolute";
            oBox.children[index].style.left = eventTypeMap.instanceArr[index][0] + "px";
            oBox.children[index].style.top = eventTypeMap.instanceArr[index][1] + "px";
          }, 0)
        })(i);
      }
    }
    initEle();
  </script>
</body>

</html>