import{b as ae,c as te}from"./role-b5c4a363.js";import{n as oe}from"./show-63c46232.js";import{g as re,a as ne,s as se}from"./permission-caf48733.js";import{d as ie,k as i,l as de,B as ue,g as d,I as ce,o as k,c as pe,a as l,w as t,u as a,J as y,i as c,h as V,b as x,m as S,F as me,p as w,G as z}from"./index-af70c94f.js";const _e={class:"dialog-footer"},fe=S("h4",null,"权限分配",-1),ge={style:{flex:"auto"}},Ve=ie({__name:"Role",setup(he){let F=oe(),v=i(8),p=i(1),P=i(0),T=()=>{g()};de(()=>{g()});let U=i([]),f=i(""),g=async(n=1)=>{p.value=n;let e=await ae(p.value,v.value,f.value);P.value=e.data.total,U.value=e.data.records},m=i(!1),s=ue({roleName:""}),D={roleName:[{required:!0,trigger:"blur",validator:(n,e,r)=>{(e==null?void 0:e.trim().length)>2?r():r(new Error("名字长度要大于2哦"))}}]},I=()=>{m.value=!0,Object.assign(s,{roleName:"",id:0}),w(()=>{b.value.clearValidate("roleName")})},K=n=>{m.value=!0,Object.assign(s,n),w(()=>{b.value.clearValidate("roleName")})},b=i(null),M=async()=>{await b.value.validate();let n=await te(s);console.log(n,"rrrrrrrRole"),n.code===200?(z({type:"success",message:s.id?"修改成功":"添加成功"}),m.value=!1,g(s.id?p.value:1)):z({type:"error",message:s.id?"修改失败":"添加失败"})},q=()=>{m.value=!1},G=()=>{g(),f.value=""},H=()=>{F.isFresh=!1,w(()=>{F.isFresh=!0})};const J={children:"children",label:"name"};let O=i([]),j=i([]),_=i(!1),A=async n=>{Object.assign(s,n),_.value=!0;let e=await re();O.value=e.data;let r=await ne(n.id);j.value=B(r.data,[])},B=(n,e)=>(n.forEach(r=>{r.level==4&&r.select&&e.push(r.id),r.children&&r.children.length>0&&B(r.children,e)}),e),N=i(null),Q=async()=>{let n=s.id,e=N.value.getCheckedKeys(),r=N.value.getHalfCheckedKeys();(await se(n,e.concat(r))).code==200&&(_.value=!1,z({type:"success",message:"修改成功"}),g(p.value))},W=()=>{_.value=!1};return(n,e)=>{const r=d("el-input"),C=d("el-form-item"),u=d("el-button"),L=d("el-form"),E=d("el-card"),h=d("el-table-column"),X=d("el-table"),Y=d("el-pagination"),Z=d("el-dialog"),$=d("el-tree"),ee=d("el-drawer"),R=ce("has");return k(),pe(me,null,[l(E,null,{default:t(()=>[l(L,{inline:!0},{default:t(()=>[l(C,{label:"角色名称"},{default:t(()=>[l(r,{placeholder:"角色名称",modelValue:a(f),"onUpdate:modelValue":e[0]||(e[0]=o=>y(f)?f.value=o:f=o)},null,8,["modelValue"])]),_:1}),l(C,null,{default:t(()=>[l(u,{type:"primary",onClick:a(G)},{default:t(()=>[c("搜索")]),_:1},8,["onClick"]),l(u,{onClick:a(H)},{default:t(()=>[c("重置")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1}),l(E,{stlye:"margin:10px 0px"},{default:t(()=>[V((k(),x(u,{icon:"Plus",type:"primary",onClick:a(I)},{default:t(()=>[c("添加角色")]),_:1},8,["onClick"])),[[R,"btn.Role.add"]]),l(X,{data:a(U),border:"",style:{margin:"10px 0px"}},{default:t(()=>[l(h,{label:"#",type:"index"}),l(h,{label:"Id",prop:"id"}),l(h,{label:"角色名称",prop:"roleName"}),l(h,{label:"创建时间",prop:"createTime"}),l(h,{label:"更新时间",prop:"updateTime"}),l(h,{label:"操作",width:"300px"},{default:t(({row:o,$index:ke})=>[V((k(),x(u,{type:"success",onClick:le=>a(A)(o)},{default:t(()=>[c("分配权限")]),_:2},1032,["onClick"])),[[R,"btn.Role.assgin"]]),V((k(),x(u,{type:"primary",onClick:le=>a(K)(o)},{default:t(()=>[c("编辑")]),_:2},1032,["onClick"])),[[R,"btn.Role.update"]]),V((k(),x(u,{type:"danger"},{default:t(()=>[c("删除")]),_:1})),[[R,"btn.Role.remove"]])]),_:1})]),_:1},8,["data"]),l(Y,{"current-page":a(p),"onUpdate:currentPage":e[1]||(e[1]=o=>y(p)?p.value=o:p=o),"page-size":a(v),"onUpdate:pageSize":e[2]||(e[2]=o=>y(v)?v.value=o:v=o),"page-sizes":[8,10,12],background:!0,layout:"prev, pager, next, jumper,->, sizes, total",total:a(P),onSizeChange:a(T),onCurrentChange:a(g)},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])]),_:1}),l(Z,{modelValue:a(m),"onUpdate:modelValue":e[4]||(e[4]=o=>y(m)?m.value=o:m=o),title:a(s).id?"修改":"添加",width:"600px"},{footer:t(()=>[S("span",_e,[l(u,{onClick:a(q)},{default:t(()=>[c("取消")]),_:1},8,["onClick"]),l(u,{type:"primary",onClick:a(M)},{default:t(()=>[c("确定")]),_:1},8,["onClick"])])]),default:t(()=>[l(L,{model:a(s),rules:a(D),ref_key:"roleForm",ref:b},{default:t(()=>[l(C,{label:"角色名称",prop:"roleName"},{default:t(()=>[l(r,{placeholder:"请填写角色名称",modelValue:a(s).roleName,"onUpdate:modelValue":e[3]||(e[3]=o=>a(s).roleName=o)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"]),l(ee,{modelValue:a(_),"onUpdate:modelValue":e[5]||(e[5]=o=>y(_)?_.value=o:_=o)},{header:t(()=>[fe]),default:t(()=>[l($,{ref_key:"tree",ref:N,data:a(O),"show-checkbox":"","node-key":"id","default-checked-keys":a(j),props:J,"default-expand-all":""},null,8,["data","default-checked-keys"])]),footer:t(()=>[S("div",ge,[l(u,{onClick:a(W)},{default:t(()=>[c("取消")]),_:1},8,["onClick"]),l(u,{type:"primary",onClick:a(Q)},{default:t(()=>[c("确定")]),_:1},8,["onClick"])])]),_:1},8,["modelValue"])],64)}}});export{Ve as default};
