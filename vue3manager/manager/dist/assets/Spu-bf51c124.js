import{H as h,d as ee,k as c,N as re,g as i,o as f,b as A,w as a,a as e,u as t,c as B,F as K,e as M,J as G,m as X,i as j,t as ie,G as L,K as pe,L as ce,I as me,h as T,v as Z}from"./index-af70c94f.js";import{g as _e,c as ge,_ as fe}from"./cate.vue_vue_type_script_setup_true_lang-b9cb86c6.js";const ve=(v,V,b)=>h.get(`/admin/product/${v+"/"+V+"?category3Id="+b}`),le=()=>h.get("/admin/product/baseTrademark/getTrademarkList"),te=()=>h.get("/admin/product/baseSaleAttrList"),ae=v=>h.get(`${"/admin/product/spuImageList/"+v}`),ue=v=>h.get(`${"/admin/product/spuSaleAttrList/"+v}`),be=v=>v.id?h.post("/admin/product/updateSpuInfo",v):h.post("/admin/product/saveSpuInfo",v),ke=v=>h.post("/admin/product/saveSkuInfo",v),ye=v=>h.get(`${"/admin/product/findBySpuId/"+v}`),Se=v=>h.delete(`${"/admin/product/deleteSpu/"+v}`),Ve=["src"],Ie=ee({__name:"OperateSpu",emits:["toList","open"],setup(v,{expose:V,emit:b}){let d=l=>{if(!l.type.includes("image"))return L({type:"error",message:"需要是图片文件"}),!1;if(l.size>4194304)return L({type:"error",message:"图片大小要小于4M"}),!1;L({type:"success",message:"上传图片成功"})},k=c(""),I=c(!1),x=c(""),w=l=>{if(k.value.trim().length===0){L({type:"error",message:"属性值不能为空"});return}l.spuSaleAttrValueList.push({saleAttrName:l.saleAttrName,baseSaleAttrId:l.baseSaleAttrId,saleAttrValueName:k.value}),k.value="",l.isEdit=!1},P=l=>{console.log(l,"file"),I.value=!0,x.value=l.url},J=()=>{b("toList",{place:0,page:"update"}),b("open")},U=c(""),D=c([]),m=c([]),p=c([]),u=c([]),_=l=>{l.isEdit=!0},r=c({category3Id:"",description:"",spuImageList:null,spuName:"",spuSaleAttrList:null,tmId:""}),$=()=>{let[l,o]=U.value.split(":");m.value.push({saleAttrName:o,baseSaleAttrId:l,spuSaleAttrValueList:[]}),U.value=""},C=re(()=>p.value.filter(l=>m.value.every(o=>o.saleAttrName!==l.name))),z=async l=>{console.log(l,"发送请求"),l&&(r.value=l);let o=l.id,n=await ue(o),g=await le(),O=await ae(o),R=await te();D.value=g.data,m.value=n.data,p.value=R.data,u.value=O.data.map(H=>({name:H.imgName,url:H.imgUrl})),console.log(n),console.log(g),console.log(O),console.log(R)},F=async l=>{r.value.spuImageList=u.value.map(n=>({imgUrl:n.response?n.response.data:n.url,imgName:n.name})),r.value.spuSaleAttrList=m.value;let o=await be(r.value);console.log(o,"xxxx"),o.code===200?(L({type:"success",message:r.value.id?"修改成功":"增加成功"}),b("open"),b("toList",{place:0,page:r.value.id?"update":"add"})):L({type:"success",message:r.value.id?"修改失败":"增加失败"})};return V({getSpuData:z,initSpuData:async l=>{Object.assign(r.value,{category3Id:l,description:"",spuImageList:null,spuName:"",spuSaleAttrList:null,tmId:""}),m.value=[],u.value=[];let o=await le(),n=await te();D.value=o.data,p.value=n.data}}),(l,o)=>{const n=i("el-input"),g=i("el-form-item"),O=i("el-option"),R=i("el-select"),H=i("Plus"),q=i("el-icon"),y=i("el-upload"),Y=i("el-dialog"),N=i("el-button"),W=i("el-table-column"),ne=i("el-tag"),oe=i("el-table"),se=i("el-form");return f(),A(se,{"label-width":"120px"},{default:a(()=>[e(g,{label:"spu名称"},{default:a(()=>[e(n,{placeholder:"请你输入SPU名称",modelValue:t(r).spuName,"onUpdate:modelValue":o[0]||(o[0]=s=>t(r).spuName=s)},null,8,["modelValue"])]),_:1}),e(g,{label:"SPU品牌"},{default:a(()=>[e(R,{modelValue:t(r).tmId,"onUpdate:modelValue":o[1]||(o[1]=s=>t(r).tmId=s)},{default:a(()=>[(f(!0),B(K,null,M(t(D),(s,Q)=>(f(),A(O,{key:Q,label:s.tmName,value:s.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(g,{label:"SPU描述"},{default:a(()=>[e(n,{type:"textarea",placeholder:"请你输入描述",modelValue:t(r).description,"onUpdate:modelValue":o[2]||(o[2]=s=>t(r).description=s)},null,8,["modelValue"])]),_:1}),e(g,{label:"SPU照片"},{default:a(()=>[e(y,{"file-list":t(u),"onUpdate:fileList":o[3]||(o[3]=s=>G(u)?u.value=s:u=s),action:"/api/admin/product/fileUpload","list-type":"picture-card","on-preview":t(P),"on-remove":l.handleRemove,"before-upload":t(d)},{default:a(()=>[e(q,null,{default:a(()=>[e(H)]),_:1})]),_:1},8,["file-list","on-preview","on-remove","before-upload"]),e(Y,{modelValue:t(I),"onUpdate:modelValue":o[4]||(o[4]=s=>G(I)?I.value=s:I=s)},{default:a(()=>[X("img",{"w-full":"",src:t(x),alt:"Preview Image"},null,8,Ve)]),_:1},8,["modelValue"])]),_:1}),e(g,{label:"SPU销售属性"},{default:a(()=>[e(R,{placeholder:t(C).length>0?`可选${t(C).length}个属性`:"無",modelValue:t(U),"onUpdate:modelValue":o[5]||(o[5]=s=>G(U)?U.value=s:U=s)},{default:a(()=>[(f(!0),B(K,null,M(t(C),(s,Q)=>(f(),A(O,{label:s.name,key:s.id,value:`${s.id}:${s.name}`},null,8,["label","value"]))),128))]),_:1},8,["placeholder","modelValue"]),e(N,{icon:"Plus",type:"primary",disabled:!t(U),onClick:t($)},{default:a(()=>[j(" 添加销售属性 ")]),_:1},8,["disabled","onClick"]),e(oe,{data:t(m)},{default:a(()=>[e(W,{width:"100px",label:"序号",type:"index"}),e(W,{label:"属性名",prop:"saleAttrName"}),e(W,{label:"属性值"},{default:a(({row:s,$index:Q})=>[(f(!0),B(K,null,M(s.spuSaleAttrValueList,(E,de)=>(f(),A(ne,{style:{margin:"4px 6px"},key:E.id,closable:"",onClose:Ce=>s.spuSaleAttrValueList.splice(de,1)},{default:a(()=>[j(ie(E.saleAttrValueName),1)]),_:2},1032,["onClose"]))),128)),s.isEdit?(f(),A(n,{key:0,modelValue:t(k),"onUpdate:modelValue":o[6]||(o[6]=E=>G(k)?k.value=E:k=E),onBlur:E=>t(w)(s),size:"small","input-style":{width:"60px",display:"inline"}},null,8,["modelValue","onBlur"])):(f(),A(N,{key:1,icon:"Plus",type:"primary",size:"small",onClick:E=>t(_)(s)},null,8,["onClick"]))]),_:1}),e(W,{label:"操作"},{default:a(({row:s,$index:Q})=>[e(N,{icon:"Delete",type:"error",size:"small",onClick:E=>t(m).splice(Q,1)},null,8,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),e(g,null,{default:a(()=>[e(N,{type:"primary",onClick:t(F),disabled:!t(m).length},{default:a(()=>[j(" 保存 ")]),_:1},8,["onClick","disabled"]),e(N,{type:"primary",onClick:t(J)},{default:a(()=>[j("取消")]),_:1},8,["onClick"])]),_:1})]),_:1})}}}),Ae=["src"],Ue=ee({__name:"OperateSku",emits:["toList","open"],setup(v,{expose:V,emit:b}){let d=c({category3Id:"",spuId:"",tmId:"",skuName:"",price:"",weight:"",skuDesc:"",skuAttrValueList:[],skuSaleAttrValueList:[],skuDefaultImg:""}),k=c([]),I=c([]),x=c([]),w=async(m,p,u)=>{console.log(u,"row"),d.value.spuId=u.id,d.value.tmId=u.tmId,d.value.category3Id=u.category3Id;let _=await _e(m,p,u.category3Id),r=await ue(u.id),$=await ae(u.id);k.value=_.data,I.value=r.data,x.value=$.data},P=c(null),J=m=>{x.value.forEach(p=>{P.value.toggleRowSelection(p,!1)}),P.value.toggleRowSelection(m,!0),d.value.skuDefaultImg=m.imgUrl},U=async()=>{d.value.skuAttrValueList=k.value.reduce((p,u)=>{if(u.addParamsData){let[_,r]=u.addParamsData.split(":");p.push({attrId:_,valueId:r})}return p},[]),d.value.skuSaleAttrValueList=I.value.reduce((p,u)=>{if(u.addSaleParam){let[_,r]=u.addSaleParam.split(":");p.push({saleAttrId:_,saleAttrValueId:r})}return p},[]),(await ke(d.value)).code===200?(L({type:"success",message:"添加成功"}),b("toList",{place:0}),b("open")):L({type:"success",message:"添加失败"})},D=()=>{b("toList",{place:0,page:"update"}),b("open")};return V({initSku:w}),(m,p)=>{const u=i("el-input"),_=i("el-form-item"),r=i("el-option"),$=i("el-select"),C=i("el-form"),z=i("el-table-column"),F=i("el-button"),S=i("el-table");return f(),A(C,{"label-width":"100px"},{default:a(()=>[e(_,{label:"SKU名称"},{default:a(()=>[e(u,{placeholder:"SKU名称",modelValue:t(d).skuName,"onUpdate:modelValue":p[0]||(p[0]=l=>t(d).skuName=l)},null,8,["modelValue"])]),_:1}),e(_,{label:"价格(元)",placeholder:"价格(元)"},{default:a(()=>[e(u,{placeholder:"价格(元)",modelValue:t(d).price,"onUpdate:modelValue":p[1]||(p[1]=l=>t(d).price=l),type:"number"},null,8,["modelValue"])]),_:1}),e(_,{label:"重量(g)"},{default:a(()=>[e(u,{placeholder:"重量(g)",modelValue:t(d).weight,"onUpdate:modelValue":p[2]||(p[2]=l=>t(d).weight=l)},null,8,["modelValue"])]),_:1}),e(_,{label:"SKU描述"},{default:a(()=>[e(u,{type:"textarea",placeholder:"SKU描述",modelValue:t(d).skuDesc,"onUpdate:modelValue":p[3]||(p[3]=l=>t(d).skuDesc=l)},null,8,["modelValue"])]),_:1}),e(_,{label:"平台属性"},{default:a(()=>[e(C,{inline:!0,"label-width":"70px"},{default:a(()=>[(f(!0),B(K,null,M(t(k),(l,o)=>(f(),A(_,{label:l.attrName,key:l.id},{default:a(()=>[e($,{placeholder:"请选择",modelValue:l.addParamsData,"onUpdate:modelValue":n=>l.addParamsData=n},{default:a(()=>[(f(!0),B(K,null,M(l.attrValueList,(n,g)=>(f(),A(r,{key:n.id,value:`${n.attrId}:${n.id}`,label:n.valueName},null,8,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]))),128))]),_:1})]),_:1}),e(_,{label:"销售属性"},{default:a(()=>[e(C,{inline:!0,"label-width":"70px"},{default:a(()=>[(f(!0),B(K,null,M(t(I),(l,o)=>(f(),A(_,{label:l.saleAttrName,key:l.id},{default:a(()=>[e($,{placeholder:"请选择",modelValue:l.addSaleParam,"onUpdate:modelValue":n=>l.addSaleParam=n},{default:a(()=>[(f(!0),B(K,null,M(l.spuSaleAttrValueList,(n,g)=>(f(),A(r,{key:n.id,value:`${n.baseSaleAttrId}:${n.id}`,label:n.saleAttrValueName},null,8,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]))),128))]),_:1})]),_:1}),e(_,{label:"图片名称"},{default:a(()=>[e(S,{border:"",data:t(x),ref_key:"imgTable",ref:P},{default:a(()=>[e(z,{type:"selection"}),e(z,{label:"图片"},{default:a(({row:l,$index:o})=>[X("img",{src:l.imgUrl,alt:"",style:{width:"50px",height:"50px"}},null,8,Ae)]),_:1}),e(z,{label:"名称",prop:"imgName"}),e(z,{label:"操作"},{default:a(({row:l,$index:o})=>[e(F,{type:"primary",onClick:n=>t(J)(l)},{default:a(()=>[j(" 设为默认图片 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),e(_,null,{default:a(()=>[e(F,{type:"primary",onClick:t(U)},{default:a(()=>[j("保存")]),_:1},8,["onClick"]),e(F,{type:"primary",onClick:t(D)},{default:a(()=>[j("取消")]),_:1},8,["onClick"])]),_:1})]),_:1})}}}),xe=["src"],we=ee({__name:"Spu",setup(v){let V=ge(),b=c(3),d=c(1),k=c(!1),I=c(0),x=c([]),w=c(!1),P=c([]),J=async S=>{w.value=!0;let l=await ye(S.id);P.value=l.data},U=async S=>{(await Se(S.id)).code===200?(L({type:"success",message:"删除成功"}),m(x.value.length>1?d.value:d.value-1)):L({type:"error",message:"系统数据不能删除捏"})},D=c(null),m=async(S=1)=>{d.value=S;let l=await ve(d.value,b.value,V.c3Id);l.code===200&&(x.value=l.data.records,I.value=l.data.total)},p=()=>{k.value=!1},u=c(0);pe(()=>V.c3Id,S=>{m()});let _=()=>{m()},r=c(null),$=S=>{k.value=!0,u.value=1,r.value.getSpuData(S)},C=({place:S,page:l})=>{u.value=S,l==="update"?m(d.value):m()},z=()=>{k.value=!0,u.value=1,r.value.initSpuData(V.c3Id)},F=S=>{u.value=2,k.value=!0,D.value.initSku(V.c1Id,V.c2Id,S)};return ce(()=>{V.$reset()}),(S,l)=>{const o=i("el-card"),n=i("el-button"),g=i("el-table-column"),O=i("el-table"),R=i("el-pagination"),H=i("el-dialog"),q=me("has");return f(),B(K,null,[e(o,null,{default:a(()=>[e(fe,{abled:t(k)},null,8,["abled"])]),_:1}),e(o,null,{default:a(()=>[T(X("div",null,[T((f(),A(n,{icon:"Plus",type:"primary",disabled:!t(V).c3Id,onClick:t(z)},{default:a(()=>[j(" 添加SPU ")]),_:1},8,["disabled","onClick"])),[[q,"btn.Spu.add"]]),e(O,{border:"",style:{margin:"10px 0"},data:t(x)},{default:a(()=>[e(g,{label:"序号",type:"index",width:"120px"}),e(g,{label:"SPU名称",prop:"spuName"}),e(g,{"show-overflow-tooltip":"",label:"SPU描述",prop:"description"}),e(g,{label:"SPU操作"},{default:a(({row:y,$index:Y})=>[T(e(n,{icon:"Plus",type:"primary",size:"small",onClick:N=>t(F)(y)},null,8,["onClick"]),[[q,"btn.Spu.addsku"]]),T(e(n,{icon:"Edit",type:"primary",size:"small",onClick:N=>t($)(y)},null,8,["onClick"]),[[q,"btn.Spu.update"]]),T(e(n,{icon:"View",type:"primary",size:"small",onClick:N=>t(J)(y)},null,8,["onClick"]),[[q,"btn.Spu.skus"]]),T(e(n,{icon:"Delete",type:"primary",size:"small",onClick:N=>t(U)(y)},null,8,["onClick"]),[[q,"btn.Sku.remove"]])]),_:1})]),_:1},8,["data"]),e(R,{"current-page":t(d),"onUpdate:currentPage":l[0]||(l[0]=y=>G(d)?d.value=y:d=y),"page-size":t(b),"onUpdate:pageSize":l[1]||(l[1]=y=>G(b)?b.value=y:b=y),"page-sizes":[3,5,7,9],background:!0,layout:"prev, pager, next, jumper,->, sizes,total",total:t(I),onSizeChange:t(_),onCurrentChange:t(m)},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])],512),[[Z,t(u)==0]]),T(e(Ie,{ref_key:"spuUpdate",ref:r,onToList:t(C),onOpen:t(p)},null,8,["onToList","onOpen"]),[[Z,t(u)==1]]),T(e(Ue,{ref_key:"skuAdd",ref:D,onOpen:t(p),onToList:t(C)},null,8,["onOpen","onToList"]),[[Z,t(u)==2]]),e(H,{modelValue:t(w),"onUpdate:modelValue":l[2]||(l[2]=y=>G(w)?w.value=y:w=y),title:"SKU列表",width:"60%","align-center":""},{default:a(()=>[e(O,{border:"",data:t(P)},{default:a(()=>[e(g,{label:"sku名字","show-overflow-tooltip":"",prop:"skuName"}),e(g,{label:"sku价格",prop:"price"}),e(g,{label:"sku重量",prop:"weight"}),e(g,{label:"sku图片"},{default:a(({row:y,$index:Y})=>[X("img",{src:y.skuDefaultImg,alt:"",style:{width:"100px",height:"100px"}},null,8,xe)]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"])]),_:1})],64)}}});export{we as default};
