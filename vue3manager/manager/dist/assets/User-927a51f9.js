import{H as B,d as _e,k as d,l as ge,B as G,g as p,I as ve,o as h,c as J,a as e,w as o,u as a,J as k,i,h as j,b as S,m as N,t as K,q as ye,F as Q,e as Ve,p as q,G as y,y as we,z as be}from"./index-af70c94f.js";import{g as Ce,u as he,d as ke,a as Ue}from"./role-b5c4a363.js";import{n as xe}from"./show-63c46232.js";import{_ as Se}from"./_plugin-vue_export-helper-c27b6911.js";const Re=(c,R,u="")=>B.get(`/admin/acl/user/${c}/${R}?username=${u}`),Ie=c=>c.id?B.put("/admin/acl/user/update",c):B.post("/admin/acl/user/save",c),ze=c=>(we("data-v-caf349fc"),c=c(),be(),c),Ae={style:{flex:"auto"}},Ne=ze(()=>N("h4",null,"分配职位",-1)),De={style:{flex:"auto"}},Oe=_e({__name:"User",setup(c){let R=xe(),u=d(1),U=d(5),F=d(0),I=d([]);ge(()=>{g()});let g=async(r=1)=>{u.value=r;let l=await Re(u.value,U.value,b.value);I.value=l.data.records,F.value=l.data.total},W=()=>{g()},n=G({username:"",name:"",password:""}),X={username:[{required:!0,trigger:"blur",validator:(r,l,s)=>{l.trim().length>=5?s():s(new Error("用户名长度不小于5哦"))}}],name:[{required:!0,trigger:"blur",validator:(r,l,s)=>{l.trim().length>=5?s():s(new Error("昵称长度不小于5哦"))}}],password:[{required:!0,trigger:"blur",validator:(r,l,s)=>{l.trim().length>=6?s():s(new Error("密码长度不小于6哦"))}}]},v=d(!1),Y=()=>{v.value=!0,Object.assign(n,{username:"",name:"",password:"",id:0}),q(()=>{V.value.clearValidate("username"),V.value.clearValidate("name"),V.value.clearValidate("password")})},Z=r=>{v.value=!0,console.log(r,"row"),Object.assign(n,r),q(()=>{V.value.clearValidate("username"),V.value.clearValidate("name")})},V=d(null),$=async()=>{if(await V.value.validate(),console.log("校验成功"),(await Ie(n)).code===200){if(y({type:"success",message:n.id?"修改成功":"添加成功"}),v.value=!1,n.id){window.location.reload();return}g()}else y({type:"error",message:n.id?"修改失败":"添加失败"})},ee=()=>{v.value=!1},z=d([]),f=d([]),w=d(!1),x=d(!1),A=d(!0),le=async r=>{w.value=!0,Object.assign(n,r);let l=await Ce(r.id);console.log(l,"result"),z.value=l.data.allRolesList,f.value=l.data.assignRoles},ae=r=>{A.value=!1,r?f.value=z.value:f.value=[]},te=()=>{z.value.length===f.value.length?(A.value=!1,x.value=!0):A.value=!0},oe=()=>{w.value=!1},D=G({userId:0,roleIdList:[]}),re=async()=>{D.userId=n.id,D.roleIdList=f.value.map(l=>l.id);let r=await he(D);console.log(r,"result"),r.code==200?(y({type:"success",message:"修改成功"}),w.value=!1,g(u.value)):y({type:"success",message:"修改失败"})},ne=async r=>{(await ke(r.id)).code===200?(y({type:"success",message:"删除成功"}),g(I.value.length>1?u.value:u.value-1)):y({type:"error",message:"系统数据不能删除"})},L=d([]),se=async()=>{let r=L.value.map(s=>s.id);(await Ue(r)).code===200?(y({type:"success",message:"删除成功"}),g(I.value.length-r.length>0?u.value:u.value-1)):y({type:"success",message:"删除失败"})},ue=r=>{L.value=r},b=d(),de=()=>{g(),b.value=""},ie=()=>{b.value="",R.isFresh=!1,q(()=>{R.isFresh=!0})};return(r,l)=>{const s=p("el-input"),C=p("el-form-item"),m=p("el-button"),O=p("el-form"),T=p("el-card"),_=p("el-table-column"),pe=p("el-popconfirm"),me=p("el-table"),ce=p("el-pagination"),H=p("el-drawer"),M=p("el-checkbox"),fe=p("el-checkbox-group"),E=ve("has");return h(),J(Q,null,[e(T,null,{default:o(()=>[e(O,{inline:!0,class:"formsearch"},{default:o(()=>[e(C,{label:"用户名:"},{default:o(()=>[e(s,{placeholder:"请输入用户名",modelValue:a(b),"onUpdate:modelValue":l[0]||(l[0]=t=>k(b)?b.value=t:b=t)},null,8,["modelValue"])]),_:1}),e(C,null,{default:o(()=>[e(m,{type:"primary",onClick:a(de)},{default:o(()=>[i("搜索")]),_:1},8,["onClick"]),e(m,{type:"info",onClick:a(ie)},{default:o(()=>[i("重置")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1}),e(T,{style:{margin:"10px 0px"}},{default:o(()=>[e(m,{type:"primary",onClick:a(Y)},{default:o(()=>[i("添加")]),_:1},8,["onClick"]),e(m,{type:"danger",onClick:a(se)},{default:o(()=>[i("批量删除")]),_:1},8,["onClick"]),e(me,{border:"",style:{margin:"6px 0px"},data:a(I),onSelectionChange:a(ue)},{default:o(()=>[e(_,{type:"selection"}),e(_,{label:"#",type:"index"}),e(_,{label:"Id",prop:"id",align:"center"}),e(_,{label:"用户名字","show-overflow-tooltip":"",prop:"username",align:"center"}),e(_,{"show-overflow-tooltip":"",label:"用户名称",prop:"name",align:"center"}),e(_,{"show-overflow-tooltip":"",label:"用户角色",prop:"roleName",align:"center"}),e(_,{"show-overflow-tooltip":"",label:"创建时间",prop:"createTime",align:"center"}),e(_,{"show-overflow-tooltip":"",label:"更新时间",prop:"updateTime",align:"center"}),e(_,{label:"操作",width:"320px"},{default:o(({row:t,$index:Be})=>[j((h(),S(m,{icon:"User",type:"primary",onClick:P=>a(le)(t)},{default:o(()=>[i(" 分配角色 ")]),_:2},1032,["onClick"])),[[E,"btn.User.add"]]),j((h(),S(m,{icon:"Edit",type:"primary",onClick:P=>a(Z)(t)},{default:o(()=>[i(" 编辑 ")]),_:2},1032,["onClick"])),[[E,"btn.Role.update"]]),e(pe,{onConfirm:P=>a(ne)(t),title:"确定要删除我么?"},{reference:o(()=>[j((h(),S(m,{icon:"Delete",type:"danger"},{default:o(()=>[i(" 删除 ")]),_:1})),[[E,"btn.Role.remove"]])]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data","onSelectionChange"]),e(ce,{"current-page":a(u),"onUpdate:currentPage":l[1]||(l[1]=t=>k(u)?u.value=t:u=t),"page-size":a(U),"onUpdate:pageSize":l[2]||(l[2]=t=>k(U)?U.value=t:U=t),"page-sizes":[5,7,9,11],background:!0,layout:"prev, pager, next, jumper,->, sizes,total",total:a(F),onCurrentChange:a(g),onSizeChange:a(W)},null,8,["current-page","page-size","total","onCurrentChange","onSizeChange"])]),_:1}),e(H,{modelValue:a(v),"onUpdate:modelValue":l[6]||(l[6]=t=>k(v)?v.value=t:v=t)},{header:o(()=>[N("h4",null,K(a(n).id?"修改用户":"添加用户"),1)]),default:o(()=>[e(O,{model:a(n),rules:a(X),ref_key:"formDrawer",ref:V},{default:o(()=>[e(C,{label:"用户姓名",prop:"username"},{default:o(()=>[e(s,{placeholder:"请填写用户名字",modelValue:a(n).username,"onUpdate:modelValue":l[3]||(l[3]=t=>a(n).username=t)},null,8,["modelValue"])]),_:1}),e(C,{label:"用户昵称",prop:"name"},{default:o(()=>[e(s,{placeholder:"请填写用户昵称",modelValue:a(n).name,"onUpdate:modelValue":l[4]||(l[4]=t=>a(n).name=t)},null,8,["modelValue"])]),_:1}),a(n).id?ye("",!0):(h(),S(C,{key:0,label:"用户密码",prop:"password"},{default:o(()=>[e(s,{placeholder:"请填写用户密码",modelValue:a(n).password,"onUpdate:modelValue":l[5]||(l[5]=t=>a(n).password=t)},null,8,["modelValue"])]),_:1}))]),_:1},8,["model","rules"])]),footer:o(()=>[N("div",Ae,[e(m,{onClick:a(ee)},{default:o(()=>[i("取消")]),_:1},8,["onClick"]),e(m,{type:"primary",onClick:a($)},{default:o(()=>[i("确定")]),_:1},8,["onClick"])])]),_:1},8,["modelValue"]),e(H,{modelValue:a(w),"onUpdate:modelValue":l[10]||(l[10]=t=>k(w)?w.value=t:w=t),direction:r.direction},{header:o(()=>[Ne]),default:o(()=>[e(O,null,{default:o(()=>[e(C,{label:"用户姓名"},{default:o(()=>[e(s,{disabled:!0,modelValue:a(n).username,"onUpdate:modelValue":l[7]||(l[7]=t=>a(n).username=t)},null,8,["modelValue"])]),_:1}),e(C,{label:"职位列表"},{default:o(()=>[e(M,{modelValue:a(x),"onUpdate:modelValue":l[8]||(l[8]=t=>k(x)?x.value=t:x=t),indeterminate:a(A),onChange:a(ae)},{default:o(()=>[i(" 全选 ")]),_:1},8,["modelValue","indeterminate","onChange"]),e(fe,{modelValue:a(f),"onUpdate:modelValue":l[9]||(l[9]=t=>k(f)?f.value=t:f=t),onChange:a(te)},{default:o(()=>[(h(!0),J(Q,null,Ve(a(z),t=>(h(),S(M,{key:t.id,label:t},{default:o(()=>[i(K(t.roleName),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue","onChange"])]),_:1})]),_:1})]),footer:o(()=>[N("div",De,[e(m,{onClick:a(oe)},{default:o(()=>[i("取消")]),_:1},8,["onClick"]),e(m,{type:"primary",onClick:a(re)},{default:o(()=>[i("确定")]),_:1},8,["onClick"])])]),_:1},8,["modelValue","direction"])],64)}}});const Me=Se(Oe,[["__scopeId","data-v-caf349fc"]]);export{Me as default};
